<div class="space-y-6">
    <div class="flex items-center justify-between">
        <h2 class="text-lg font-semibold text-gray-900">{{ if .isEdit }}Edit User{{ else }}Create User{{ end }}</h2>
        <button onclick="closeUserSlideOver()" class="text-gray-400 hover:text-gray-600">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
            </svg>
        </button>
    </div>

    {{ if .errors }}{{ if mapGet .errors "general" }}
    <div class="bg-red-50 border border-red-200 rounded-lg p-3 text-sm text-red-700">{{ mapGet .errors "general" }}</div>
    {{ end }}{{ end }}

    <form hx-post="{{ if .isEdit }}/admin/users/{{ .formUser.ID }}{{ else }}/admin/users{{ end }}"
          hx-target="#user-form-container"
          hx-swap="innerHTML"
          class="space-y-4">
        {{ .csrfField }}

        {{ if not .isEdit }}
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Username</label>
            <input type="text" name="username" value="{{ .formUser.Username }}" class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:ring-brand-500 focus:border-brand-500{{ if .errors }}{{ if mapGet .errors "username" }} border-red-300{{ end }}{{ end }}" required>
            {{ if .errors }}{{ if mapGet .errors "username" }}<p class="text-xs text-red-600 mt-1">{{ mapGet .errors "username" }}</p>{{ end }}{{ end }}
        </div>
        {{ end }}

        <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Full Name</label>
            <input type="text" name="full_name" value="{{ .formUser.FullName }}" class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:ring-brand-500 focus:border-brand-500{{ if .errors }}{{ if mapGet .errors "full_name" }} border-red-300{{ end }}{{ end }}" required>
            {{ if .errors }}{{ if mapGet .errors "full_name" }}<p class="text-xs text-red-600 mt-1">{{ mapGet .errors "full_name" }}</p>{{ end }}{{ end }}
        </div>

        <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
            <input type="email" name="email" value="{{ .formUser.Email }}" class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:ring-brand-500 focus:border-brand-500{{ if .errors }}{{ if mapGet .errors "email" }} border-red-300{{ end }}{{ end }}" required>
            {{ if .errors }}{{ if mapGet .errors "email" }}<p class="text-xs text-red-600 mt-1">{{ mapGet .errors "email" }}</p>{{ end }}{{ end }}
        </div>

        {{ if not .isEdit }}
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Password</label>
            <input type="password" name="password" class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:ring-brand-500 focus:border-brand-500{{ if .errors }}{{ if mapGet .errors "password" }} border-red-300{{ end }}{{ end }}" required minlength="6">
            {{ if .errors }}{{ if mapGet .errors "password" }}<p class="text-xs text-red-600 mt-1">{{ mapGet .errors "password" }}</p>{{ end }}{{ end }}
        </div>
        {{ end }}

        <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Role</label>
            <select name="role" class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:ring-brand-500 focus:border-brand-500">
                <option value="user" {{ if eq .formUser.Role "user" }}selected{{ end }}>User</option>
                <option value="admin" {{ if eq .formUser.Role "admin" }}selected{{ end }}>Admin</option>
            </select>
            {{ if .errors }}{{ if mapGet .errors "role" }}<p class="text-xs text-red-600 mt-1">{{ mapGet .errors "role" }}</p>{{ end }}{{ end }}
        </div>

        {{ if .allProjects }}
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Assigned Projects</label>
            <p class="text-xs text-gray-500 mb-2">Select projects this user can access (admin users have access to all projects regardless)</p>
            <div class="space-y-2 max-h-48 overflow-y-auto border border-gray-200 rounded-md p-3">
                {{ range .allProjects }}
                <label class="flex items-center gap-2 text-sm">
                    <input type="checkbox" name="project_ids" value="{{ .ID }}" class="rounded border-gray-300 text-brand-600 focus:ring-brand-500"
                        {{ if containsInt $.assignedIDs .ID }}checked{{ end }}>
                    <span>{{ .Name }} <span class="text-gray-400">({{ .DCPrefix }})</span></span>
                </label>
                {{ end }}
            </div>
        </div>
        {{ end }}

        <div class="flex gap-2 pt-4 border-t border-gray-200">
            <button type="submit" class="btn btn-primary text-sm flex-1">{{ if .isEdit }}Update User{{ else }}Create User{{ end }}</button>
            <button type="button" onclick="closeUserSlideOver()" class="btn btn-secondary text-sm">Cancel</button>
        </div>
    </form>
</div>
