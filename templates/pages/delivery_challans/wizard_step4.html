{{ define "title" }}New Shipment - Review{{ end }}

{{ define "content" }}
<div class="max-w-5xl mx-auto">
    {{ template "wizard_steps" . }}

    <form method="POST" action="{{.basePath}}/shipments/wizard/create" id="wizard-step4-form">
        {{.csrfField}}

        {{range .hiddenFields}}
        <input type="hidden" name="{{.Name}}" value="{{.Value}}">
        {{end}}

        <!-- Shipment Summary -->
        <div class="card mb-6">
            <h2 class="text-lg font-semibold text-gray-900 mb-4">Shipment Summary</h2>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <div>
                    <p class="text-sm text-gray-500">Template</p>
                    <p class="font-medium">{{.review.TemplateName}}</p>
                </div>
                <div>
                    <p class="text-sm text-gray-500">Number of Sets</p>
                    <p class="font-medium">{{.review.NumSets}}</p>
                </div>
                <div>
                    <p class="text-sm text-gray-500">Challan Date</p>
                    <p class="font-medium">{{.review.ChallanDate}}</p>
                </div>
                <div>
                    <p class="text-sm text-gray-500">Tax Type</p>
                    <p class="font-medium">{{if eq .review.TaxType "cgst_sgst"}}CGST + SGST{{else}}IGST{{end}}</p>
                </div>
            </div>
        </div>

        <!-- Transport Details -->
        <div class="card mb-6">
            <h2 class="text-lg font-semibold text-gray-900 mb-4">Transport Details</h2>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <div>
                    <p class="text-sm text-gray-500">Transporter</p>
                    <p class="font-medium">{{if .review.TransporterName}}{{.review.TransporterName}}{{else}}—{{end}}</p>
                </div>
                <div>
                    <p class="text-sm text-gray-500">Vehicle Number</p>
                    <p class="font-medium">{{if .review.VehicleNumber}}{{.review.VehicleNumber}}{{else}}—{{end}}</p>
                </div>
                <div>
                    <p class="text-sm text-gray-500">Docket Number</p>
                    <p class="font-medium">{{if .review.DocketNumber}}{{.review.DocketNumber}}{{else}}—{{end}}</p>
                </div>
                <div>
                    <p class="text-sm text-gray-500">E-Way Bill</p>
                    <p class="font-medium">{{if .review.EwayBillNumber}}{{.review.EwayBillNumber}}{{else}}—{{end}}</p>
                </div>
            </div>
        </div>

        <!-- Addresses -->
        <div class="card mb-6">
            <h2 class="text-lg font-semibold text-gray-900 mb-4">Addresses</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                {{if .review.BillFromAddress}}
                <div>
                    <p class="text-sm font-medium text-gray-500 mb-1">Bill From</p>
                    <div class="p-3 bg-gray-50 rounded-lg text-sm">{{.review.BillFromAddress}}</div>
                </div>
                {{end}}
                {{if .review.DispatchFromAddress}}
                <div>
                    <p class="text-sm font-medium text-gray-500 mb-1">Dispatch From</p>
                    <div class="p-3 bg-gray-50 rounded-lg text-sm">{{.review.DispatchFromAddress}}</div>
                </div>
                {{end}}
                <div>
                    <p class="text-sm font-medium text-gray-500 mb-1">Bill To</p>
                    <div class="p-3 bg-gray-50 rounded-lg text-sm">{{.review.BillToAddress}}</div>
                </div>
            </div>
        </div>

        <!-- Transit DC Preview -->
        <div class="card mb-6 border-l-4 border-blue-500">
            <h2 class="text-lg font-semibold text-gray-900 mb-4">
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800 mr-2">Transit</span>
                Transit DC
            </h2>
            <p class="text-sm text-gray-500 mb-4">Ship To: {{.review.TransitShipToAddress}}</p>
            <div class="overflow-x-auto">
                <table class="w-full text-sm">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Product</th>
                            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">HSN</th>
                            <th class="px-4 py-2 text-right text-xs font-medium text-gray-500 uppercase">Qty</th>
                            <th class="px-4 py-2 text-right text-xs font-medium text-gray-500 uppercase">Rate</th>
                            <th class="px-4 py-2 text-right text-xs font-medium text-gray-500 uppercase">Amount</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-200">
                        {{range .review.Products}}
                        <tr>
                            <td class="px-4 py-2">{{.ItemName}}</td>
                            <td class="px-4 py-2">{{.HSNCode}}</td>
                            <td class="px-4 py-2 text-right">{{.TotalQuantity}}</td>
                            <td class="px-4 py-2 text-right">₹{{.Rate}}</td>
                            <td class="px-4 py-2 text-right">₹{{.Amount}}</td>
                        </tr>
                        {{end}}
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Official DCs Preview -->
        {{range $i, $odc := .review.OfficialDCs}}
        <div class="card mb-4 border-l-4 border-purple-500">
            <h3 class="text-md font-semibold text-gray-900 mb-2">
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-purple-100 text-purple-800 mr-2">Official</span>
                Official DC - Set {{add $i 1}}
            </h3>
            <p class="text-sm text-gray-500 mb-3">Ship To: {{$odc.ShipToAddress}}</p>
            <div class="overflow-x-auto">
                <table class="w-full text-sm">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Product</th>
                            <th class="px-4 py-2 text-right text-xs font-medium text-gray-500 uppercase">Qty</th>
                            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Serials</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-200">
                        {{range $odc.Products}}
                        <tr>
                            <td class="px-4 py-2">{{.ItemName}}</td>
                            <td class="px-4 py-2 text-right">{{.Quantity}}</td>
                            <td class="px-4 py-2 text-sm text-gray-600">{{join .SerialNumbers ", "}}</td>
                        </tr>
                        {{end}}
                    </tbody>
                </table>
            </div>
        </div>
        {{end}}

        <!-- Summary Stats -->
        <div class="card mb-6 bg-brand-50">
            <div class="grid grid-cols-3 gap-4 text-center">
                <div>
                    <p class="text-2xl font-bold text-brand-700">{{.review.TotalDCs}}</p>
                    <p class="text-sm text-gray-600">Total DCs</p>
                </div>
                <div>
                    <p class="text-2xl font-bold text-brand-700">{{.review.TotalProducts}}</p>
                    <p class="text-sm text-gray-600">Products</p>
                </div>
                <div>
                    <p class="text-2xl font-bold text-brand-700">{{.review.TotalSerials}}</p>
                    <p class="text-sm text-gray-600">Serial Numbers</p>
                </div>
            </div>
        </div>

        <!-- Actions -->
        <div class="flex justify-between items-center">
            <a href="javascript:history.back()" class="btn btn-secondary">← Back</a>
            <button type="submit" class="btn btn-primary bg-green-600 hover:bg-green-700 focus:ring-green-500">Create Shipment</button>
        </div>
    </form>
</div>
{{ end }}
