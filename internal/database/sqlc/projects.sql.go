// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.30.0
// source: projects.sql

package db

import (
	"context"
	"database/sql"
)

const CountIssuedDCsForProject = `-- name: CountIssuedDCsForProject :one
SELECT COUNT(*)
FROM delivery_challans
WHERE project_id = ? AND status = 'issued'
`

func (q *Queries) CountIssuedDCsForProject(ctx context.Context, projectID int64) (int64, error) {
	row := q.db.QueryRowContext(ctx, CountIssuedDCsForProject, projectID)
	var count int64
	err := row.Scan(&count)
	return count, err
}

const CreateProject = `-- name: CreateProject :execresult
INSERT INTO projects (
    name, description, dc_prefix, tender_ref_number, tender_ref_details,
    po_reference, po_date, bill_from_address, dispatch_from_address,
    company_gstin, company_email, company_cin,
    company_signature_path, company_seal_path,
    dc_number_format, dc_number_separator,
    purpose_text, seq_padding, created_by
) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
`

type CreateProjectParams struct {
	Name                 string
	Description          string
	DcPrefix             string
	TenderRefNumber      string
	TenderRefDetails     string
	PoReference          string
	PoDate               sql.NullTime
	BillFromAddress      string
	DispatchFromAddress  string
	CompanyGstin         string
	CompanyEmail         string
	CompanyCin           string
	CompanySignaturePath sql.NullString
	CompanySealPath      sql.NullString
	DcNumberFormat       string
	DcNumberSeparator    string
	PurposeText          string
	SeqPadding           int64
	CreatedBy            int64
}

func (q *Queries) CreateProject(ctx context.Context, arg CreateProjectParams) (sql.Result, error) {
	return q.db.ExecContext(ctx, CreateProject,
		arg.Name,
		arg.Description,
		arg.DcPrefix,
		arg.TenderRefNumber,
		arg.TenderRefDetails,
		arg.PoReference,
		arg.PoDate,
		arg.BillFromAddress,
		arg.DispatchFromAddress,
		arg.CompanyGstin,
		arg.CompanyEmail,
		arg.CompanyCin,
		arg.CompanySignaturePath,
		arg.CompanySealPath,
		arg.DcNumberFormat,
		arg.DcNumberSeparator,
		arg.PurposeText,
		arg.SeqPadding,
		arg.CreatedBy,
	)
}

const DeleteProject = `-- name: DeleteProject :exec
DELETE FROM projects
WHERE id = ?
`

func (q *Queries) DeleteProject(ctx context.Context, id int64) error {
	_, err := q.db.ExecContext(ctx, DeleteProject, id)
	return err
}

const GetAllProjectOptions = `-- name: GetAllProjectOptions :many
SELECT id, name
FROM projects
ORDER BY name
`

type GetAllProjectOptionsRow struct {
	ID   int64
	Name string
}

func (q *Queries) GetAllProjectOptions(ctx context.Context) ([]GetAllProjectOptionsRow, error) {
	rows, err := q.db.QueryContext(ctx, GetAllProjectOptions)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	items := []GetAllProjectOptionsRow{}
	for rows.Next() {
		var i GetAllProjectOptionsRow
		if err := rows.Scan(&i.ID, &i.Name); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Close(); err != nil {
		return nil, err
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const GetAllProjects = `-- name: GetAllProjects :many
SELECT
    p.id, p.name, p.description, p.dc_prefix,
    p.tender_ref_number, p.tender_ref_details,
    p.po_reference, p.po_date,
    p.bill_from_address, p.dispatch_from_address,
    p.company_gstin, p.company_email, p.company_cin,
    p.company_signature_path, p.company_seal_path,
    p.dc_number_format, p.dc_number_separator,
    p.purpose_text, p.seq_padding,
    p.last_transit_dc_number, p.last_official_dc_number,
    p.created_by, p.created_at, p.updated_at,
    COUNT(DISTINCT CASE WHEN dc.dc_type = 'transit' THEN dc.id END) AS transit_dc_count,
    COUNT(DISTINCT CASE WHEN dc.dc_type = 'official' THEN dc.id END) AS official_dc_count,
    COUNT(DISTINCT t.id) AS template_count,
    COUNT(DISTINCT pr.id) AS product_count
FROM projects p
LEFT JOIN delivery_challans dc ON p.id = dc.project_id
LEFT JOIN dc_templates t ON p.id = t.project_id
LEFT JOIN products pr ON p.id = pr.project_id
GROUP BY p.id
ORDER BY p.created_at DESC
`

type GetAllProjectsRow struct {
	ID                   int64
	Name                 string
	Description          string
	DcPrefix             string
	TenderRefNumber      string
	TenderRefDetails     string
	PoReference          string
	PoDate               sql.NullTime
	BillFromAddress      string
	DispatchFromAddress  string
	CompanyGstin         string
	CompanyEmail         string
	CompanyCin           string
	CompanySignaturePath sql.NullString
	CompanySealPath      sql.NullString
	DcNumberFormat       string
	DcNumberSeparator    string
	PurposeText          string
	SeqPadding           int64
	LastTransitDcNumber  sql.NullInt64
	LastOfficialDcNumber sql.NullInt64
	CreatedBy            int64
	CreatedAt            sql.NullTime
	UpdatedAt            sql.NullTime
	TransitDcCount       int64
	OfficialDcCount      int64
	TemplateCount        int64
	ProductCount         int64
}

func (q *Queries) GetAllProjects(ctx context.Context) ([]GetAllProjectsRow, error) {
	rows, err := q.db.QueryContext(ctx, GetAllProjects)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	items := []GetAllProjectsRow{}
	for rows.Next() {
		var i GetAllProjectsRow
		if err := rows.Scan(
			&i.ID,
			&i.Name,
			&i.Description,
			&i.DcPrefix,
			&i.TenderRefNumber,
			&i.TenderRefDetails,
			&i.PoReference,
			&i.PoDate,
			&i.BillFromAddress,
			&i.DispatchFromAddress,
			&i.CompanyGstin,
			&i.CompanyEmail,
			&i.CompanyCin,
			&i.CompanySignaturePath,
			&i.CompanySealPath,
			&i.DcNumberFormat,
			&i.DcNumberSeparator,
			&i.PurposeText,
			&i.SeqPadding,
			&i.LastTransitDcNumber,
			&i.LastOfficialDcNumber,
			&i.CreatedBy,
			&i.CreatedAt,
			&i.UpdatedAt,
			&i.TransitDcCount,
			&i.OfficialDcCount,
			&i.TemplateCount,
			&i.ProductCount,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Close(); err != nil {
		return nil, err
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const GetProjectByID = `-- name: GetProjectByID :one
SELECT
    p.id, p.name, p.description, p.dc_prefix,
    p.tender_ref_number, p.tender_ref_details,
    p.po_reference, p.po_date,
    p.bill_from_address, p.dispatch_from_address,
    p.company_gstin, p.company_email, p.company_cin,
    p.company_signature_path, p.company_seal_path,
    p.dc_number_format, p.dc_number_separator,
    p.purpose_text, p.seq_padding,
    p.last_transit_dc_number, p.last_official_dc_number,
    p.created_by, p.created_at, p.updated_at,
    COUNT(DISTINCT CASE WHEN dc.dc_type = 'transit' THEN dc.id END) AS transit_dc_count,
    COUNT(DISTINCT CASE WHEN dc.dc_type = 'official' THEN dc.id END) AS official_dc_count,
    COUNT(DISTINCT t.id) AS template_count,
    COUNT(DISTINCT pr.id) AS product_count
FROM projects p
LEFT JOIN delivery_challans dc ON p.id = dc.project_id
LEFT JOIN dc_templates t ON p.id = t.project_id
LEFT JOIN products pr ON p.id = pr.project_id
WHERE p.id = ?
GROUP BY p.id
`

type GetProjectByIDRow struct {
	ID                   int64
	Name                 string
	Description          string
	DcPrefix             string
	TenderRefNumber      string
	TenderRefDetails     string
	PoReference          string
	PoDate               sql.NullTime
	BillFromAddress      string
	DispatchFromAddress  string
	CompanyGstin         string
	CompanyEmail         string
	CompanyCin           string
	CompanySignaturePath sql.NullString
	CompanySealPath      sql.NullString
	DcNumberFormat       string
	DcNumberSeparator    string
	PurposeText          string
	SeqPadding           int64
	LastTransitDcNumber  sql.NullInt64
	LastOfficialDcNumber sql.NullInt64
	CreatedBy            int64
	CreatedAt            sql.NullTime
	UpdatedAt            sql.NullTime
	TransitDcCount       int64
	OfficialDcCount      int64
	TemplateCount        int64
	ProductCount         int64
}

func (q *Queries) GetProjectByID(ctx context.Context, id int64) (GetProjectByIDRow, error) {
	row := q.db.QueryRowContext(ctx, GetProjectByID, id)
	var i GetProjectByIDRow
	err := row.Scan(
		&i.ID,
		&i.Name,
		&i.Description,
		&i.DcPrefix,
		&i.TenderRefNumber,
		&i.TenderRefDetails,
		&i.PoReference,
		&i.PoDate,
		&i.BillFromAddress,
		&i.DispatchFromAddress,
		&i.CompanyGstin,
		&i.CompanyEmail,
		&i.CompanyCin,
		&i.CompanySignaturePath,
		&i.CompanySealPath,
		&i.DcNumberFormat,
		&i.DcNumberSeparator,
		&i.PurposeText,
		&i.SeqPadding,
		&i.LastTransitDcNumber,
		&i.LastOfficialDcNumber,
		&i.CreatedBy,
		&i.CreatedAt,
		&i.UpdatedAt,
		&i.TransitDcCount,
		&i.OfficialDcCount,
		&i.TemplateCount,
		&i.ProductCount,
	)
	return i, err
}

const ProjectExistsWithName = `-- name: ProjectExistsWithName :one
SELECT COUNT(*)
FROM projects
WHERE LOWER(name) = LOWER(?) AND id != ?
`

type ProjectExistsWithNameParams struct {
	LOWER string
	ID    int64
}

func (q *Queries) ProjectExistsWithName(ctx context.Context, arg ProjectExistsWithNameParams) (int64, error) {
	row := q.db.QueryRowContext(ctx, ProjectExistsWithName, arg.LOWER, arg.ID)
	var count int64
	err := row.Scan(&count)
	return count, err
}

const ProjectExistsWithPrefix = `-- name: ProjectExistsWithPrefix :one
SELECT COUNT(*)
FROM projects
WHERE LOWER(dc_prefix) = LOWER(?) AND id != ?
`

type ProjectExistsWithPrefixParams struct {
	LOWER string
	ID    int64
}

func (q *Queries) ProjectExistsWithPrefix(ctx context.Context, arg ProjectExistsWithPrefixParams) (int64, error) {
	row := q.db.QueryRowContext(ctx, ProjectExistsWithPrefix, arg.LOWER, arg.ID)
	var count int64
	err := row.Scan(&count)
	return count, err
}

const UpdateProject = `-- name: UpdateProject :exec
UPDATE projects SET
    name = ?, description = ?, dc_prefix = ?,
    tender_ref_number = ?, tender_ref_details = ?,
    po_reference = ?, po_date = ?,
    bill_from_address = ?, dispatch_from_address = ?,
    company_gstin = ?, company_email = ?, company_cin = ?,
    company_signature_path = ?, company_seal_path = ?,
    dc_number_format = ?, dc_number_separator = ?,
    purpose_text = ?, seq_padding = ?,
    updated_at = CURRENT_TIMESTAMP
WHERE id = ?
`

type UpdateProjectParams struct {
	Name                 string
	Description          string
	DcPrefix             string
	TenderRefNumber      string
	TenderRefDetails     string
	PoReference          string
	PoDate               sql.NullTime
	BillFromAddress      string
	DispatchFromAddress  string
	CompanyGstin         string
	CompanyEmail         string
	CompanyCin           string
	CompanySignaturePath sql.NullString
	CompanySealPath      sql.NullString
	DcNumberFormat       string
	DcNumberSeparator    string
	PurposeText          string
	SeqPadding           int64
	ID                   int64
}

func (q *Queries) UpdateProject(ctx context.Context, arg UpdateProjectParams) error {
	_, err := q.db.ExecContext(ctx, UpdateProject,
		arg.Name,
		arg.Description,
		arg.DcPrefix,
		arg.TenderRefNumber,
		arg.TenderRefDetails,
		arg.PoReference,
		arg.PoDate,
		arg.BillFromAddress,
		arg.DispatchFromAddress,
		arg.CompanyGstin,
		arg.CompanyEmail,
		arg.CompanyCin,
		arg.CompanySignaturePath,
		arg.CompanySealPath,
		arg.DcNumberFormat,
		arg.DcNumberSeparator,
		arg.PurposeText,
		arg.SeqPadding,
		arg.ID,
	)
	return err
}

const UpdateProjectSettingsCompany = `-- name: UpdateProjectSettingsCompany :exec
UPDATE projects
SET bill_from_address = ?, dispatch_from_address = ?, company_gstin = ?,
    company_email = ?, company_cin = ?, company_signature_path = ?,
    company_seal_path = ?, updated_at = CURRENT_TIMESTAMP
WHERE id = ?
`

type UpdateProjectSettingsCompanyParams struct {
	BillFromAddress      string
	DispatchFromAddress  string
	CompanyGstin         string
	CompanyEmail         string
	CompanyCin           string
	CompanySignaturePath sql.NullString
	CompanySealPath      sql.NullString
	ID                   int64
}

func (q *Queries) UpdateProjectSettingsCompany(ctx context.Context, arg UpdateProjectSettingsCompanyParams) error {
	_, err := q.db.ExecContext(ctx, UpdateProjectSettingsCompany,
		arg.BillFromAddress,
		arg.DispatchFromAddress,
		arg.CompanyGstin,
		arg.CompanyEmail,
		arg.CompanyCin,
		arg.CompanySignaturePath,
		arg.CompanySealPath,
		arg.ID,
	)
	return err
}

const UpdateProjectSettingsDCConfig = `-- name: UpdateProjectSettingsDCConfig :exec
UPDATE projects
SET dc_number_format = ?, dc_number_separator = ?, purpose_text = ?,
    seq_padding = ?, updated_at = CURRENT_TIMESTAMP
WHERE id = ?
`

type UpdateProjectSettingsDCConfigParams struct {
	DcNumberFormat    string
	DcNumberSeparator string
	PurposeText       string
	SeqPadding        int64
	ID                int64
}

func (q *Queries) UpdateProjectSettingsDCConfig(ctx context.Context, arg UpdateProjectSettingsDCConfigParams) error {
	_, err := q.db.ExecContext(ctx, UpdateProjectSettingsDCConfig,
		arg.DcNumberFormat,
		arg.DcNumberSeparator,
		arg.PurposeText,
		arg.SeqPadding,
		arg.ID,
	)
	return err
}

const UpdateProjectSettingsGeneral = `-- name: UpdateProjectSettingsGeneral :exec
UPDATE projects
SET name = ?, description = ?, dc_prefix = ?, updated_at = CURRENT_TIMESTAMP
WHERE id = ?
`

type UpdateProjectSettingsGeneralParams struct {
	Name        string
	Description string
	DcPrefix    string
	ID          int64
}

func (q *Queries) UpdateProjectSettingsGeneral(ctx context.Context, arg UpdateProjectSettingsGeneralParams) error {
	_, err := q.db.ExecContext(ctx, UpdateProjectSettingsGeneral,
		arg.Name,
		arg.Description,
		arg.DcPrefix,
		arg.ID,
	)
	return err
}

const UpdateProjectSettingsTender = `-- name: UpdateProjectSettingsTender :exec
UPDATE projects
SET tender_ref_number = ?, tender_ref_details = ?, po_reference = ?,
    po_date = ?, updated_at = CURRENT_TIMESTAMP
WHERE id = ?
`

type UpdateProjectSettingsTenderParams struct {
	TenderRefNumber  string
	TenderRefDetails string
	PoReference      string
	PoDate           sql.NullTime
	ID               int64
}

func (q *Queries) UpdateProjectSettingsTender(ctx context.Context, arg UpdateProjectSettingsTenderParams) error {
	_, err := q.db.ExecContext(ctx, UpdateProjectSettingsTender,
		arg.TenderRefNumber,
		arg.TenderRefDetails,
		arg.PoReference,
		arg.PoDate,
		arg.ID,
	)
	return err
}
